# ═══════════════════════════════════════════════════════════════
#                    TrendRadar 配置文件
# ═══════════════════════════════════════════════════════════════


# ===============================================================
# 1. 基础设置
# ===============================================================
app:
  # 时区配置（影响所有时间显示、推送窗口判断、数据存储）
  # 常用时区：
  #   - Asia/Shanghai (北京时间 UTC+8)
  #   - America/New_York (美东时间 UTC-5/-4)
  #   - Europe/London (伦敦时间 UTC+0/+1)
  # 完整时区列表: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  timezone: "Asia/Shanghai"
  show_version_update: true           # 显示版本更新提示


# ===============================================================
# 2. 数据源 - 热榜平台 (v2026.01.09 战时修正版)
#
# id: 平台唯一标识（勿修改）
# name: 显示名称（可自定义，修改后不影响运行）
# ===============================================================
platforms:
  - id: "cls-telegraph"
    name: "⚡ 财联社电报"   # [B户进攻雷达] 重点盯：火箭发射、卫星组网、军工订单、低空经济政策。这是“拓斯达/军工龙头”的生命线！
  
  - id: "wallstreetcn-hot"
    name: "🌎 华尔街见闻"   # [A户防守雷达] 重点盯：美股科技（英伟达/特斯拉）走势、美联储关税政策。CPO和芯片跌没跌？全看这里。

  - id: "cls-hot"
    name: "🔥 财联社热门"   # [主线确认] 确认“商业航天”是否还在榜一？如果是，B户继续贪婪；如果掉下去了，小心退潮。

  - id: "gelonghui"
    name: "🇭🇰 格隆汇"       # [港美联动] 服务A户的“康方生物/中概互联”，以及监控美股“军工/防务板块”的隔夜表现（映射A股）。

  - id: "xueqiu"
    name: "❄️ 雪球热帖"     # [情绪反指] 重点观察散户对“中际旭创（恐慌吗？）”和“拓斯达（亢奋吗？）”的讨论。人声鼎沸时要卖，哀鸿遍野时要买。

# ===============================================================
# 3. 数据源 - RSS 订阅
#
# 与热榜数据分开存储，按时间流展示
# 每个源配置：id(唯一标识)、name(显示名称)、url(订阅地址)
# enabled: 可选，默认 true
# max_age_days: 可选，覆盖全局 freshness_filter.max_age_days
# ===============================================================
rss:
  enabled: true                       # 是否启用 RSS 抓取

  # 文章新鲜度过滤配置（全局默认值）
  # 过滤掉发布时间超过指定天数的旧文章，避免同一篇文章重复出现在推送中
  #
  # 过滤逻辑：
  #   - 文章发布时间距当前时间（app.timezone 时区）超过 N 天则不推送
  #   - 无发布时间的文章会被保留（不过滤）
  #
  # ⚠️ 过滤时机：在推送阶段过滤
  #    - 所有文章都会存入数据库（MCP Server 的 AI 查询仍可访问）
  #    - 只有新鲜的文章会被推送到通知渠道
  freshness_filter:
    enabled: true                     # 是否启用新鲜度过滤（默认启用）
    max_age_days: 3                   # 最大文章年龄（天）
                                      # - 正整数：只推送 N 天内的文章
                                      # - 0：禁用过滤，推送所有文章

  # 单个 feed 可配置 max_age_days 覆盖全局设置：
  # - 不配置：使用全局 freshness_filter.max_age_days（默认 3 天）
  # - 正整数：覆盖全局设置，只推送此天数内的文章
  # - 0：禁用此频道的新鲜度过滤，推送所有文章
  feeds:
    - id: "hacker-news"
      name: "Hacker News"
      url: "https://hnrss.org/frontpage"
      enabled: false
      # max_age_days: 1               # 示例：只推送1天内的文章

    - id: "ruanyifeng"
      name: "阮一峰的网络日志"
      url: "http://www.ruanyifeng.com/blog/atom.xml"
      # max_age_days: 7               # 示例：推送7天内的文章（更新较慢的博客）
    
    - id: "yahoo-finance"
      name: "雅虎财经"
      url: "https://finance.yahoo.com/news/rssindex"
      enabled: false                  # 禁用

    # 自定义源示例
    # - id: "custom-feed"
    #   name: "自定义源"
    #   url: "https://example.com/feed.xml"
    #   enabled: false
    #   max_age_days: 0               # 示例：禁用过滤，推送所有文章


# ===============================================================
# 4. 报告模式
#
# 🔸 daily（当日汇总模式）
#    • 推送时机：按时推送(默认每小时推送一次)
#    • 显示内容：当日所有匹配新闻 + 新增新闻区域
#    • 适用场景：日报总结、全面了解当日热点趋势
#
# 🔸 current（当前榜单模式）
#    • 推送时机：按时推送(默认每小时推送一次)
#    • 显示内容：当前榜单匹配新闻 + 新增新闻区域
#    • 适用场景：实时热点追踪、了解当前最火的内容
#
# 🔸 incremental（增量监控模式）
#    • 推送时机：有新增才推送
#    • 显示内容：新出现的匹配频率词新闻
#    • 适用场景：避免重复信息干扰
# ===============================================================
report:
  mode: "current"                     # 可选: daily | current | incremental
  display_mode: "keyword"             # 可选: keyword | platform
                                      # keyword: 按关键词分组显示（默认）
                                      # platform: 按平台/来源分组显示
  rank_threshold: 5                   # 排名高亮阈值
  sort_by_position_first: true       # true=按配置位置排序，false=按热点条数排序
  max_news_per_keyword: 15             # 每个关键词最大显示数量（0=不限制）
  reverse_content_order: false        # false=热点词汇统计在前，true=新增热点新闻在前


# ===============================================================
# 5. 推送通知
#
# ⚠️ 重要安全警告 ⚠️
#
# 🔴 请务必妥善保管好 webhooks，不要公开!!!
# 🔴 如果你以 fork 的方式部署在 GitHub 上，请勿在此填写
# 🔴 而是将 webhooks 填入 GitHub Secrets
#    (Settings → Secrets and variables → Actions)
# 🔴 否则：
#    - 轻则：手机上收到大量垃圾广告推送
#    - 重则：webhook 被滥用造成严重安全隐患
#
# 📌 多账号支持说明
#
# • 使用分号(;)分隔多个账号，如："url1;url2;url3"
# • 需要配对的配置（如 Telegram 的 token 和 chat_id）数量必须一致
# • 每个渠道最多支持 max_accounts_per_channel 个账号
# • 邮箱已支持多收件人（逗号分隔）
# ===============================================================
notification:
  enabled: true                       # 是否启用通知功能

  # 🕐 推送时间窗口控制（可选功能）
  # 用途：限制推送的时间范围，避免非工作时间打扰
  # 适用场景：
  #   - 只想在工作日白天接收推送（如 09:00-18:00）
  #   - 希望在晚上固定时间收到汇总（如 20:00-22:00）
  # 注意：GitHub Actions 执行时间不稳定，时间范围建议至少留足 2 小时
  #       如果想要精准的定时推送，建议使用 Docker 部署在个人服务器上
  push_window:
    enabled: false                    # 是否启用推送时间窗口控制
    start: "20:00"                    # 开始时间（北京时间）
    end: "22:00"                      # 结束时间（北京时间）
    once_per_day: true                # true=窗口内只推送一次，false=窗口内每次执行都推送

  # 推送渠道配置
  channels:
    feishu:
      webhook_url: ""                 # 飞书机器人 webhook URL

    dingtalk:
      webhook_url: ""                 # 钉钉机器人 webhook URL

    wework:
      webhook_url: ""                 # 企业微信机器人 webhook URL
      msg_type: "markdown"            # 消息类型：markdown(群机器人) | text(个人微信应用)

    telegram:
      bot_token: ""                   # Telegram Bot Token
      chat_id: ""                     # Telegram Chat ID

    email:
      from: ""                        # 发件人邮箱地址
      password: ""                    # 发件人邮箱密码或授权码
      to: ""                          # 收件人邮箱，多个用逗号分隔
      smtp_server: ""                 # SMTP 服务器（可选，留空自动识别）
      smtp_port: ""                   # SMTP 端口（可选，留空自动识别）

    ntfy:
      server_url: "https://ntfy.sh"   # ntfy 服务器地址（可改为自托管）
      topic: ""                       # ntfy 主题名称
      token: ""                       # ntfy 访问令牌（可选，用于私有主题）

    bark:
      url: ""                         # Bark 推送 URL（格式：https://api.day.app/your_device_key）

    slack:
      webhook_url: ""                 # Slack Incoming Webhook URL


# ===============================================================
# 6. 存储配置
# ===============================================================
storage:
  # 存储后端选择
  # - auto: 自动选择（GitHub Actions 且配置了远程存储 → remote，否则 → local）
  # - local: 本地 SQLite + TXT/HTML 文件
  # - remote: 远程云存储（S3 兼容协议，支持 R2/OSS/COS 等）
  backend: "auto"

  # 数据格式选项
  formats:
    sqlite: true                      # 主存储（必须启用）
    txt: false                        # 是否生成 TXT 快照
    html: true                       # 是否生成 HTML 报告（⚠️ 邮件推送必须设为 true）

  # 本地存储配置
  local:
    data_dir: "output"                # 数据目录
    retention_days: 0                 # 保留天数（0=永久保留）

  # 远程存储配置（S3 兼容协议）
  # 支持: Cloudflare R2, 阿里云 OSS, 腾讯云 COS, AWS S3, MinIO 等
  # 建议将敏感信息配置在 GitHub Secrets 或环境变量中
  remote:
    retention_days: 0                 # 保留天数（0=永久保留）
    # S3 兼容配置（或使用环境变量 S3_ENDPOINT_URL 等）
    endpoint_url: ""                  # 服务端点
                                      # Cloudflare R2: https://<account_id>.r2.cloudflarestorage.com
                                      # 阿里云 OSS: https://oss-cn-hangzhou.aliyuncs.com
                                      # 腾讯云 COS: https://cos.ap-guangzhou.myqcloud.com
    bucket_name: ""                   # 存储桶名称
    access_key_id: ""                 # 访问密钥 ID
    secret_access_key: ""             # 访问密钥
    region: ""                        # 区域（可选，部分服务商需要）

  # 数据拉取配置（从远程同步到本地）
  # 用于 MCP Server 等场景：爬虫存到远程，MCP 拉取到本地分析
  pull:
    enabled: false                    # 是否启用启动时自动拉取
    days: 7                           # 拉取最近 N 天的数据


# ===============================================================
# 7. 高级设置（一般无需修改）
# ===============================================================
advanced:
  # 版本检查
  version_check_url: "https://raw.githubusercontent.com/sansan0/TrendRadar/refs/heads/master/version"

  # 爬虫设置
  crawler:
    enabled: true                     # 是否启用爬取新闻功能
    request_interval: 1000            # 请求间隔（毫秒）
    use_proxy: false                  # 是否启用代理
    default_proxy: "http://127.0.0.1:10801"

  # RSS 设置
  rss:
    request_interval: 2000            # 请求间隔（毫秒）
    timeout: 15                       # 请求超时（秒）
    use_proxy: false                  # 是否使用代理
    proxy_url: ""                     # RSS 专属代理（留空则使用 crawler.default_proxy）
    notification_enabled: true        # 是否启用 RSS 通知推送

  # 排序权重（用于重新排序不同平台的热搜）
  # 合起来等于 1
  weight:
    rank: 0.4                         # 排名权重
    frequency: 0.5                    # 频次权重
    hotness: 0.1                      # 热度权重

  # 多账号限制
  max_accounts_per_channel: 3         # 每个渠道最大账号数量

  # 消息分批大小（字节）- 内部配置，请勿修改
  batch_size:
    default: 4000
    dingtalk: 20000
    feishu: 30000
    bark: 4000
    slack: 4000
  batch_send_interval: 3              # 批次发送间隔（秒）
  feishu_message_separator: "━━━━━━━━━━━━━━━━━━━"
